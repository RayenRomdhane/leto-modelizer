# Leto Modelizer (leto-modelizer)

Technical topology low-code editing tool.

## Install

```
npm install
```

## Default commands

Usage explanation of scripts in `package.json`.

### dev

Run the application in dev mode.

If the global proxy is unavailable on https://cors.isomorphic-git.org, you can use a local proxy.

### Setup local proxy and use it in dev

Run these commands

```bash
git submodule update --init --recursive
cd cors-proxy
sed -i "s/80/9999/g" Dockerfile
docker build . -t cors-proxy
docker run -p 9999:9999 --rm -ti cors-proxy

# To run it in another terminal on the root of your project
CORS_ISOMORPHIC_BASE_URL="http://localhost:9999" npm run dev
```

### build

Build the application in `dist` folder.

### docs

Generate documentation with esdoc.

### lint

Run eslint to check on the project.

### lint:fix

Run eslint to fix on the project.

### lint:report

Generate issues report with eslint for sonar.

### test

Run all the unit tests.

### test:coverage

Run all the unit tests and generate coverage report of the unit tests for sonar.

### test:e2e

Run all the e2e tests and generate videos accordingly, here: ./cypress/videos.


### Run the e2e tests locally with specific proxy

1. install the proxy

```bash
npm install @isomorphic-git/cors-proxy
```

2. build the proxy

```bash
git submodule update --init --recursive
cd cors-proxy
docker build . -t cors-proxy
```

3. Run the application with the proxy

```bash
docker-compose up -d
```

4. Run the e2e tests

```bash
npm run test:e2e
```

## Development

### Directory structure

This is the default directory structure we use for the project:

```
leto-modelizer
├ cypress              ⇨ Contains all the cypress related files
│ ├ e2e                ⇨ Contains all the e2e tests
│ ├ videos             ⇨ Contains all videos of each run test (only locally)
│ └ support            ⇨ Contains all support files for e2e tests
│   └ step_definitions ⇨ Contains all step definitions for e2e tests
├ dist                 ⇨ Contains the built application
├ docs                 ⇨ Contains all files generated by esdoc
├ public               ⇨ Contains all public files, like favicon
├ reports              ⇨ Contains all the report files for sonar
├ src                  ⇨ Contains all files for the leto-modelizer application
│ ├ assets             ⇨ Contains all the assets
│ ├ boot               ⇨ Contains all boot configurations
│ ├ components         ⇨ Contains all vue components
│ ├ css                ⇨ Contains all style files
│ ├ i18n               ⇨ Contains translation engine and translation files
│ ├ layouts            ⇨ Contains all the page layouts
│ ├ pages              ⇨ Contains all the pages
│ ├ router             ⇨ Contains the router engine and the route definitions
│ └ stores             ⇨ Contains store engine and all storage definitions
└ tests                ⇨ Contains all files related to the tests
```

### How to release

We use [Semantic Versioning](https://semver.org/spec/v2.0.0.html) as guideline for the version management.

Steps to release:
- Create a new branch labeled `release/vX.Y.Z` from the latest `main`.
- Improve the version number in `package.json`, `package-lock.json` and `changelog.md`.
- Verify the content of the `changelog.md`.
- Commit the modifications with the label `Release version X.Y.Z`.
- Create a pull request on github for this branch into `main`.
- Once the pull request validated and merged, tag the `main` branch with `vX.Y.Z`
- After the tag is pushed, make the release on the tag in GitHub

### Git: Default branch

The default branch is main. Direct commit on it is forbidden. The only way to update the application is through pull request.

Release tag are only done on the `main` branch.

### Git: Branch naming policy

`[BRANCH_TYPE]/[BRANCH_NAME]`

* `BRANCH_TYPE` is a prefix to describe the purpose of the branch. Accepted prefixes are:
    * `feature`, used for feature development
    * `bugfix`, used for bug fix
    * `improvement`, used for refacto
    * `library`, used for updating library
    * `prerelease`, used for preparing the branch for the release
    * `release`, used for releasing project
    * `hotfix`, used for applying a hotfix on main
* `BRANCH_NAME` is managed by this regex: `[a-z0-9._-]` (`_` is used as space character).
